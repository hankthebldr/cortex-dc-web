# Production Environment Configuration for Self-Hosted Cortex DC
# Optimized for high-performance and scalability

# ======================
# Deployment Mode
# ======================
DEPLOYMENT_MODE=self-hosted

# ======================
# PostgreSQL Database
# ======================
# Direct connection (for migrations and admin tasks)
DATABASE_URL="postgresql://cortex_user:your_secure_password@localhost:5432/cortex_dc?schema=public"

# Connection pooler (PgBouncer) - Use this for application connections
# Recommended: 10-20 connections per CPU core
DATABASE_URL_POOLED="postgresql://cortex_user:your_secure_password@localhost:6432/cortex_dc?schema=public&pgbouncer=true"

# Database configuration
POSTGRES_USER=cortex_user
POSTGRES_PASSWORD=your_secure_password
POSTGRES_DB=cortex_dc
POSTGRES_HOST=localhost
POSTGRES_PORT=5432

# Connection pool settings
DATABASE_POOL_MIN=10
DATABASE_POOL_MAX=100
DATABASE_POOL_IDLE_TIMEOUT=30000
DATABASE_POOL_CONNECTION_TIMEOUT=5000

# ======================
# Redis Cache
# ======================
REDIS_URL="redis://localhost:6379"
REDIS_PASSWORD=your_redis_password
REDIS_TLS_ENABLED=false

# Redis configuration
REDIS_MAX_RETRIES=10
REDIS_RETRY_DELAY=100
REDIS_CONNECT_TIMEOUT=10000

# Cache TTL settings (in seconds)
CACHE_TTL_USER=300          # 5 minutes
CACHE_TTL_ANALYTICS=600     # 10 minutes
CACHE_TTL_LIST=120          # 2 minutes
CACHE_TTL_DETAIL=300        # 5 minutes

# ======================
# Keycloak Auth
# ======================
KEYCLOAK_URL=http://localhost:8080
KEYCLOAK_REALM=cortex-dc
KEYCLOAK_CLIENT_ID=cortex-dc-web
KEYCLOAK_CLIENT_SECRET=your_keycloak_client_secret

# ======================
# MinIO Storage
# ======================
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_USE_SSL=false
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=cortex-dc

# ======================
# Application Settings
# ======================
NODE_ENV=production
PORT=3000
API_PORT=3001

# Session configuration
SESSION_SECRET=your_session_secret_key_at_least_32_characters
SESSION_MAX_AGE=604800000  # 7 days in milliseconds

# ======================
# Performance Monitoring
# ======================
ENABLE_METRICS=true
METRICS_PORT=9090
ENABLE_HEALTH_CHECKS=true
HEALTH_CHECK_INTERVAL=30000

# ======================
# Logging
# ======================
LOG_LEVEL=info
LOG_FORMAT=json
ENABLE_QUERY_LOGGING=false  # Set to true for debugging, false for production

# ======================
# Rate Limiting
# ======================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW=900000    # 15 minutes
RATE_LIMIT_MAX_REQUESTS=100

# ======================
# CORS Settings
# ======================
CORS_ORIGIN=http://localhost:3000
CORS_CREDENTIALS=true
